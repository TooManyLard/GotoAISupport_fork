<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#00A599">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>GOTO AI Support</title>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- 言語選択画面 -->
        <div class="language-select-screen" id="language-select-screen">
            <h1>GOTO AI Support</h1>
            <p>お好みの言語を選択して会話を始めましょう</p>
            
            <div class="language-grid">
                <div class="language-card" data-lang="en">
                    <div class="flag">🇺🇸</div>
                    <div class="card-text">
                        <h3>English</h3>
                        <p>Start chatting in English</p>
                    </div>
                </div>
                
                <div class="language-card" data-lang="ja">
                    <div class="flag">🇯🇵</div>
                    <div class="card-text">
                        <h3>日本語</h3>
                        <p>日本語でチャットを開始</p>
                    </div>
                </div>
                
                <div class="language-card" data-lang="ko">
                    <div class="flag">🇰🇷</div>
                    <div class="card-text">
                        <h3>한국어</h3>
                        <p>한국어로 채팅 시작</p>
                    </div>
                </div>
                
                <div class="language-card" data-lang="zh">
                    <div class="flag">🇨🇳</div>
                    <div class="card-text">
                        <h3>中文</h3>
                        <p>用中文开始聊天</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 情報入力フォーム画面 -->
        <div class="info-form-screen" id="info-form-screen">
            <h1 id="info-form-title">物件情報を入力</h1>
            <p id="info-form-description">サポートを受けるために必要な情報を入力してください</p>
            
            <form class="info-form" id="property-form">
                <div class="form-group">
                    <label for="property-id" id="property-id-label">物件ID</label>
                    <input type="text" id="property-id" required autocomplete="off" inputmode="text">
                </div>
                
                <div class="form-group">
                    <label for="room-number" id="room-number-label">部屋番号</label>
                    <input type="text" id="room-number" required autocomplete="off" inputmode="text">
                </div>
                
                <div class="form-group">
                    <label for="issue-description" id="issue-label">お困りのこと</label>
                    <textarea id="issue-description" required></textarea>
                </div>
                
                <button type="submit" class="submit-btn" id="submit-info">送信</button>
            </form>
        </div>
        
        <!-- チャット画面 -->
        <div class="chat-screen" id="chat-screen">
            <div class="chat-header">
                <h1>GOTO AI Support</h1>
                
                <div class="language-selector">
                    <button class="language-btn" data-lang="en">English</button>
                    <button class="language-btn" data-lang="ko">한국어</button>
                    <button class="language-btn" data-lang="ja">日本語</button>
                    <button class="language-btn" data-lang="zh">中文</button>
                </div>
            </div>
            
            <div class="chat-container" id="chat-container">
                <div class="messages-container" id="messages-container">
                    <!-- メッセージはここに追加されます -->
                </div>
            </div>
            
            <div class="input-container">
                <input type="text" id="user-input" placeholder="メッセージを入力..." aria-label="メッセージを入力" autocomplete="off">
                <button class="send-btn" id="send-button" aria-label="メッセージを送信">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // セッションIDを保存
        let sessionId = null;
        // 現在選択されている言語
        let currentLanguage = 'ja'; // デフォルト値（初期選択画面からは上書きされます）
        // 物件情報を保存
        let propertyInfo = {
            propertyId: '',
            roomNumber: '',
            issue: ''
        };

        // DOM要素
        const languageSelectScreen = document.getElementById('language-select-screen');
        const infoFormScreen = document.getElementById('info-form-screen');
        const chatScreen = document.getElementById('chat-screen');
        const chatContainer = document.getElementById('chat-container');
        const messagesContainer = document.getElementById('messages-container');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const languageButtons = document.querySelectorAll('.language-btn');
        const languageCards = document.querySelectorAll('.language-card');
        const propertyForm = document.getElementById('property-form');

        // フォーム要素
        const infoFormTitle = document.getElementById('info-form-title');
        const infoFormDescription = document.getElementById('info-form-description');
        const propertyIdLabel = document.getElementById('property-id-label');
        const roomNumberLabel = document.getElementById('room-number-label');
        const issueLabel = document.getElementById('issue-label');
        const submitInfoBtn = document.getElementById('submit-info');
        const propertyIdInput = document.getElementById('property-id');
        const roomNumberInput = document.getElementById('room-number');
        const issueInput = document.getElementById('issue-description');

        // 言語選択カード初期化
        languageCards.forEach(card => {
            card.addEventListener('click', () => {
                const selectedLang = card.dataset.lang;
                
                // アニメーション効果
                card.classList.add('active');
                setTimeout(() => {
                    // 言語を設定して情報入力フォームを表示
                    setupInfoForm(selectedLang);
                    card.classList.remove('active');
                }, 300);
            });
        });

        // 情報入力フォームのセットアップ
        function setupInfoForm(lang) {
            // 言語を設定
            currentLanguage = lang;
            
            // 言語ボタンを更新
            updateLanguageButtons(lang);
            
            // フォームのラベルとテキストを言語に合わせて設定
            const formTexts = {
                'en': {
                    title: 'Enter Property Information',
                    description: 'Please provide the necessary information to receive support',
                    propertyIdLabel: 'Property ID',
                    roomNumberLabel: 'Room Number',
                    issueLabel: 'Issue Description',
                    submitBtn: 'Submit'
                },
                'ja': {
                    title: '物件情報を入力',
                    description: 'サポートを受けるために必要な情報を入力してください',
                    propertyIdLabel: '物件ID',
                    roomNumberLabel: '部屋番号',
                    issueLabel: 'お困りのこと',
                    submitBtn: '送信'
                },
                'ko': {
                    title: '물건 정보 입력',
                    description: '지원을 받기 위해 필요한 정보를 입력해주세요',
                    propertyIdLabel: '물건 ID',
                    roomNumberLabel: '방 번호',
                    issueLabel: '문제 설명',
                    submitBtn: '제출'
                },
                'zh': {
                    title: '输入物业信息',
                    description: '请提供必要信息以获取支持',
                    propertyIdLabel: '物业ID',
                    roomNumberLabel: '房间号',
                    issueLabel: '问题描述',
                    submitBtn: '提交'
                }
            };
            
            const texts = formTexts[lang] || formTexts['en'];
            
            infoFormTitle.textContent = texts.title;
            infoFormDescription.textContent = texts.description;
            propertyIdLabel.textContent = texts.propertyIdLabel;
            roomNumberLabel.textContent = texts.roomNumberLabel;
            issueLabel.textContent = texts.issueLabel;
            submitInfoBtn.textContent = texts.submitBtn;
            
            // 表示切替（トランジション効果付き）
            languageSelectScreen.style.opacity = '0';
            setTimeout(() => {
                languageSelectScreen.style.display = 'none';
                infoFormScreen.style.display = 'flex';
                infoFormScreen.style.opacity = '0';
                
                setTimeout(() => {
                    infoFormScreen.style.opacity = '1';
                    // フォームの最初の入力フィールドにフォーカス
                    propertyIdInput.focus();
                }, 50);
            }, 300);
        }

        // フォーム送信処理
        propertyForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // フォームの値を取得して保存
            propertyInfo = {
                propertyId: propertyIdInput.value.trim(),
                roomNumber: roomNumberInput.value.trim(),
                issue: issueInput.value.trim()
